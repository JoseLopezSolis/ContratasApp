<?xml version="1.0" encoding="utf-8"?>

<base:BasePage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:ContratasApp.ViewModels"
    xmlns:models="clr-namespace:ContratasApp.Models"
    x:DataType="vm:ContractDetailPageViewModel"
    xmlns:base="clr-namespace:ContratasApp.Views.Base"
    x:Class="ContratasApp.Views.ContractDetailPage"
    Title="Detalle de contrata">
  
  <ScrollView>
    <VerticalStackLayout Padding="20" Spacing="16">

      <!-- Botón para agregar el próximo pago -->
      <Button
        Text="Agregar pago"
        Command="{Binding AddPaymentCommand}"
        IsEnabled="{Binding Payments, Converter={StaticResource HasPendingPaymentsConverter}}"
         />

      <!-- Historial de pagos -->
      <CollectionView
        ItemsSource="{Binding Payments}"
        EmptyView="No hay pagos registrados"
        VerticalOptions="FillAndExpand">

        <CollectionView.ItemTemplate>
          <DataTemplate x:DataType="models:PaymentSchedule">
            <Frame Style="{StaticResource CardFrameStyle}" Padding="12" Margin="0,4">
              <Grid ColumnDefinitions="Auto,*,Auto,Auto" RowDefinitions="Auto">
                <!-- Número de pago -->
                <Label Grid.Column="0"
                       Text="{Binding PaymentNumber}"
                       Style="{StaticResource TitleLabelStyle}" />

                <!-- Monto dado -->
                <Label Grid.Column="1"
                       Text="{Binding Amount, StringFormat='{}{0:C0}'}"
                       Style="{StaticResource SubtitleLabelStyle}"
                       HorizontalOptions="Center" />

                <!-- Fecha/hora real de pago -->
                <Label Grid.Column="2"
                       Text="{Binding PaidDate, StringFormat='{0:dd/MM/yyyy HH:mm}'}"
                       Style="{StaticResource SubtitleLabelStyle}"
                       HorizontalOptions="Center" />

                <!-- Icono de estado -->
                <Label Grid.Column="3"
                       Text="{Binding IsPaid, Converter={StaticResource BoolToCheckmarkConverter}}"
                       Style="{StaticResource TitleLabelStyle}"
                       HorizontalOptions="End" />
              </Grid>
            </Frame>
          </DataTemplate>
        </CollectionView.ItemTemplate>
      </CollectionView>

    </VerticalStackLayout>
  </ScrollView>
</base:BasePage>